<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Expert">
	<!-- 좋아요 순 상위 3명의 전문가 -->
	<select id="topThree" resultType="expertdto">
		select * from expert join user on expert.user_id = user.user_id order by totalCnt desc limit 3
	</select>
	<!-- 전체 전문가 수  -->
	<select id="getExpertCnt" parameterType="long" resultType="long">
		select count(*) from expert 
	</select>
	<!-- 전문가 정렬 -->
	<select id="getList" parameterType="hashmap" resultType="expertdto">
		SELECT expert.*, user.name, user.age, expert_career_list.career_name
	      FROM expert
	      JOIN user ON expert.user_id = user.user_id JOIN expert_career_list ON expert.expert_idx = expert_career_list.expert_idx
	      order by expert_idx desc limit #{startRow},#{pageSize}
	</select>
	<!-- 좋아요순 정렬 -->
	<select id="getExpertSortByLike" parameterType="hashmap" resultType="expertdto">
		SELECT expert.*, user.name, user.age, expert_career_list.career_name
        FROM expert
        JOIN user ON expert.user_id = user.user_id
        JOIN expert_career_list ON expert.expert_idx = expert_career_list.expert_idx
        ORDER BY totalCnt DESC
        LIMIT #{startRow}, #{pageSize}
	</select>
	<!--  -->
	<select id="getExpertSortByLowCost" parameterType="hashmap" resultType="expertdto">
		SELECT expert.*, user.name, user.age, expert_career_list.career_name
        FROM expert
        JOIN user ON expert.user_id = user.user_id
        JOIN expert_career_list ON expert.expert_idx = expert_career_list.expert_idx
        ORDER BY cost ASC
        LIMIT #{startRow}, #{pageSize}
	</select>
	<select id="getExpertSortByHighCost" parameterType="hashmap" resultType="expertdto">
		SELECT expert.*, user.name, user.age, expert_career_list.career_name
        FROM expert
        JOIN user ON expert.user_id = user.user_id
        JOIN expert_career_list ON expert.expert_idx = expert_career_list.expert_idx
        ORDER BY cost DESC
        LIMIT #{startRow}, #{pageSize}
	</select>
	<select id="getExpertById" parameterType="long" resultType="expertdto">
		select expert.*, user.name, user.age, expert_career_list.career_name
		from expert
		join user on expert.user_id = user.user_id join expert_career_list on expert.expert_idx = expert_career_list.expert_idx
		where expert.expert_idx = #{expert_idx}
	</select>
	
	<select id="getExpertSortByKeyword" resultType="expertdto" parameterType="hashmap">
	    SELECT expert.*, user.name, user.age, expert_career_list.career_name
	    FROM expert
	    JOIN user ON expert.user_id = user.user_id
	    JOIN expert_career_list ON expert.expert_idx = expert_career_list.expert_idx
	    WHERE keyword_list LIKE CONCAT('%', #{keyword}, '%')
	    LIMIT #{startRow}, #{pageSize}
	</select>
	<insert id="insertExpert" parameterType="expertdto">
  		insert into
  		expert(user_id, resume, is_drivable, location, keyword_list, available_time, cost, account)
  		values(#{user_id},#{resume},#{is_drivable},#{location},#{keyword_list},#{available_time},#{cost},#{account})
  	</insert>
  	<select id="selectExpertInfo" parameterType="String" resultType="expertdto">
  		select * from expert where user_id = #{user_id};
  	</select>
    
    <!-- 자격증 삽입 -->
	<insert id="insertLicense" parameterType="expertls">
  		insert into expert_license_list(expert_idx, license_name, acquire_date)
  		values(#{expert_idx},#{license_name},#{acquire_date})
  	</insert>
	<!-- 경력 삽입 -->
	<insert id="insertCareer" parameterType="expertca">
  		insert into expert_career_list(expert_idx, career_name, start_time, end_time)
  		values(#{expert_idx},#{career_name},#{start_time},#{end_time})
  	</insert>
	
</mapper>
